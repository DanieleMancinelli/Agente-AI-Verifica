<svg width="1000" height="700" xmlns="http://www.w3.org/2000/svg">
  <!-- Sfondo -->
  <rect width="1000" height="700" fill="#f8f9fa" />
  
  <!-- Titolo -->
  <text x="500" y="30" font-family="Arial" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">Architettura AI Chef Agent (ReAct Pattern)</text>
  
  <!-- Legenda Prompt -->
  <rect x="50" y="50" width="20" height="20" fill="#ffecb3" stroke="#ffa000" />
  <text x="80" y="65" font-family="Arial" font-size="14">Prompt / Istruzioni LLM</text>

  <!-- MODULI INTERNI -->
  <!-- app.py -->
  <rect x="50" y="150" width="180" height="400" rx="10" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" />
  <text x="140" y="175" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle">UI (app.py)</text>
  <text x="140" y="200" font-family="Arial" font-size="12" text-anchor="middle">Streamlit Interface</text>
  <rect x="65" y="450" width="150" height="80" rx="5" fill="#fff9c4" stroke="#fbc02d" />
  <text x="140" y="475" font-family="Arial" font-size="14" font-weight="bold" text-anchor="middle">Session State</text>
  <text x="140" y="495" font-family="Arial" font-size="12" text-anchor="middle">(Sidebar &amp; Memory)</text>

  <!-- agent_engine.py -->
  <rect x="350" y="150" width="300" height="400" rx="10" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" />
  <text x="500" y="175" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle">Agent Engine</text>
  <text x="500" y="195" font-family="Arial" font-size="12" text-anchor="middle">(agent_engine.py)</text>
  
  <!-- Prompts inside Engine -->
  <rect x="370" y="230" width="260" height="60" rx="5" fill="#ffecb3" stroke="#ffa000" />
  <text x="500" y="255" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">1. EXTRACTION_PROMPT</text>
  <text x="500" y="275" font-family="Arial" font-size="11" text-anchor="middle">Input -> Dati Tecnici</text>

  <rect x="370" y="460" width="260" height="60" rx="5" fill="#ffecb3" stroke="#ffa000" />
  <text x="500" y="485" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">2. RESPONSE_PROMPT</text>
  <text x="500" y="505" font-family="Arial" font-size="11" text-anchor="middle">Stato + Input -> Chat</text>

  <!-- tools.py & models.py -->
  <rect x="350" y="600" width="300" height="80" rx="10" fill="#e8f5e9" stroke="#388e3c" stroke-width="2" />
  <text x="500" y="625" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Logic (tools.py &amp; models.py)</text>
  <text x="500" y="650" font-family="Arial" font-size="12" text-anchor="middle">Pydantic Validation &amp; State Updates</text>

  <!-- ESTERNO: GROQ -->
  <rect x="750" y="250" width="220" height="200" rx="10" fill="#ffebee" stroke="#d32f2f" stroke-width="2" />
  <text x="860" y="280" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle">GROQ API</text>
  <text x="860" y="305" font-family="Arial" font-size="14" text-anchor="middle" fill="#d32f2f">INTERNET</text>
  <text x="860" y="350" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">Model:</text>
  <text x="860" y="370" font-family="Arial" font-size="12" text-anchor="middle">llama-3.3-70b-versatile</text>

  <!-- FRECCE E FLUSSO -->
  <!-- 1. User input -->
  <path d="M 230 300 L 340 300" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />
  <circle cx="285" cy="300" r="12" fill="#333" />
  <text x="285" y="305" font-family="Arial" font-size="12" fill="white" text-anchor="middle">1</text>
  <text x="285" y="285" font-family="Arial" font-size="10" text-anchor="middle">User Message</text>

  <!-- 2. Call to Groq (Extract) -->
  <path d="M 650 260 L 740 260" stroke="#d32f2f" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrow)" />
  <circle cx="695" cy="260" r="12" fill="#d32f2f" />
  <text x="695" y="265" font-family="Arial" font-size="12" fill="white" text-anchor="middle">2</text>
  <text x="695" y="245" font-family="Arial" font-size="10" text-anchor="middle">Extract Data</text>

  <!-- 3. Return Tags -->
  <path d="M 740 290 L 650 290" stroke="#d32f2f" stroke-width="2" fill="none" marker-end="url(#arrow)" />
  <circle cx="695" cy="290" r="12" fill="#d32f2f" />
  <text x="695" y="295" font-family="Arial" font-size="12" fill="white" text-anchor="middle">3</text>
  <text x="695" y="315" font-family="Arial" font-size="10" text-anchor="middle">Raw Dati (ADD/PREF)</text>

  <!-- 4. Tool Call -->
  <path d="M 500 550 L 500 590" stroke="#388e3c" stroke-width="2" fill="none" marker-end="url(#arrow)" />
  <circle cx="500" cy="570" r="12" fill="#388e3c" />
  <text x="500" y="575" font-family="Arial" font-size="12" fill="white" text-anchor="middle">4</text>

  <!-- 5. Update State -->
  <path d="M 350 640 L 140 640 L 140 540" stroke="#388e3c" stroke-width="2" fill="none" marker-end="url(#arrow)" />
  <circle cx="245" cy="640" r="12" fill="#388e3c" />
  <text x="245" y="645" font-family="Arial" font-size="12" fill="white" text-anchor="middle">5</text>
  <text x="245" y="660" font-family="Arial" font-size="10" text-anchor="middle">Update Sidebar</text>

  <!-- 6. Read State for Response -->
  <path d="M 215 500 L 340 500" stroke="#1976d2" stroke-width="2" fill="none" marker-end="url(#arrow)" />
  <circle cx="285" cy="500" r="12" fill="#1976d2" />
  <text x="285" y="505" font-family="Arial" font-size="12" fill="white" text-anchor="middle">6</text>
  <text x="285" y="520" font-family="Arial" font-size="10" text-anchor="middle">Get Pantry Info</text>

  <!-- 7. Call to Groq (Chat) -->
  <path d="M 650 480 L 740 480" stroke="#d32f2f" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrow)" />
  <circle cx="695" cy="480" r="12" fill="#d32f2f" />
  <text x="695" y="485" font-family="Arial" font-size="12" fill="white" text-anchor="middle">7</text>

  <!-- 8. Return Chat Message -->
  <path d="M 740 430 L 650 430" stroke="#d32f2f" stroke-width="2" fill="none" marker-end="url(#arrow)" />
  <circle cx="695" cy="430" r="12" fill="#d32f2f" />
  <text x="695" y="435" font-family="Arial" font-size="12" fill="white" text-anchor="middle">8</text>

  <!-- 9. Final Answer to UI -->
  <path d="M 340 380 L 230 380" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrow)" />
  <circle cx="285" cy="380" r="12" fill="#333" />
  <text x="285" y="385" font-family="Arial" font-size="12" fill="white" text-anchor="middle">9</text>

  <!-- 10. Rerun Streamlit -->
  <path d="M 140 150 A 50 50 0 1 1 150 150" stroke="#1976d2" stroke-width="2" fill="none" marker-end="url(#arrow)" />
  <circle cx="180" cy="110" r="12" fill="#1976d2" />
  <text x="180" y="115" font-family="Arial" font-size="12" fill="white" text-anchor="middle">10</text>
  <text x="230" y="115" font-family="Arial" font-size="10">UI Rerender</text>

  <!-- Marker per le frecce -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333" />
    </marker>
  </defs>
</svg>
